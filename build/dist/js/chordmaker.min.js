var ChordMaker=function(){return{makeChord:function(a,b){return new Chord(a,b)},makeChordFromString:function(a,b,c){if(c||(c=.5),b=b.replace(/^\s+|\s+$/g,""),""!==b){var d=6,e=5,f=1,g="",h=30,i="top",j=[],k="white",l="white",m=b.split("\n");_.each(m,function(a){if(""!==a){if(-1!=a.indexOf("[")){a=a.replace(/^\[|\]$/g,"");var b=a.split(",");return _.each(b,function(a){a=a.replace(/^\s+|\s+$/g,"");var b=a.split("="),d=b[0],j=b[1];"base_fret"==d?f=parseInt(j,10):"label"==d?g=j:"orientation"==d?i=j:"num_frets"==d?e=parseInt(j,10):"scale"==d?c=parseFloat(j):"fret_gap"==d&&(h=parseInt(j,10))}),void 0}var d=/\s*(\d{1,2}):/,m=parseInt(a.match(d)[1].replace(/^\s+|\s+$/g,""),10),n=a.replace(d,""),o=n.split(",");_.each(o,function(a){l=k;var b=/\(.*\)/g,c=a.match(b);if(c){var d=c[0];a=a.replace(d,""),d=d.replace(/^\(|\)$/g,"");var g=d.split(";");_.each(g,function(a){if(""!==a){var b=a.split(":"),c=b[0].replace(/^\s+|\s+$/g,""),d=b[1].replace(/^\s+|\s+$/g,"");"color"==c&&(l=d)}})}var h={};if(h.string=m,-1!=a.indexOf("{")){a=a.replace(/[{|}]/g,"");var i=a.split(" ");h.fret=i[0].replace(/^\s+|\s+$/g,""),i[1]&&(h.finger=i[1])}else h.fret=a.replace(/^\s+|\s+$/g,"");if(h.fret.match(/^[oO0]$/))h.fret=0,h.open=!0;else if(h.fret.match(/[mMxX]/))h.muted=!0;else{h.fret=parseInt(h.fret,10);var n=parseInt(h.fret,10)-f;n>e&&(e=h.fret+1)}h.color=l,j.push(_.clone(h))})}});var n=new Chord(a,{scale:c,num_frets:e,num_strings:d,base_fret:f,orientation:i,label:g,fret_gap:h});return n.addNotes(j),n}},makeScaleDiagram:function(a,b,c,d){if(_.has(Vex.Flow.Music.noteValues,b)&&_.has(Vex.Flow.Music.scales,c)){a.innerHTML="",_.isUndefined(d)&&(d={}),_.isUndefined(d.orientation)&&(d.orientation="left"),_.isUndefined(d.num_frets)&&(d.num_frets=17),_.isUndefined(d.fret_gap)&&(d.fret_gap=50);for(var e=new Vex.Flow.Music,f=new Chord(a,d),g=f.getBaseFret(),h=f.getNumFrets(),i=f.getTuning(),j=e.getScaleTones(e.getNoteValue(b),Vex.Flow.Music.scales[c]),k=e.getNoteValue(b),l=[],m=0;m<f.getNumStrings();m++)for(var n=e.getNoteValue(i[m].toLowerCase()),o=n+(g-1),p=0;h>p;p++){var q=(o+p)%12;if(_.include(j,q)){var r={string:m,fret:g-1+p};if(r.fret<=0)continue;q==k&&(r.tonic=!0,r.color="black"),l.push(_.clone(r))}}return f.addNotes(l),f}},makeArpeggioDiagram:function(a,b,c,d){if(_.has(Vex.Flow.Music.noteValues,b)&&_.has(Vex.Flow.Music.arpeggios,c)){a.innerHTML="",_.isUndefined(d)&&(d={}),_.isUndefined(d.orientation)&&(d.orientation="left"),_.isUndefined(d.num_frets)&&(d.num_frets=17),_.isUndefined(d.fret_gap)&&(d.fret_gap=50);for(var e=new Vex.Flow.Music,f=new Chord(a,d),g=f.getBaseFret(),h=f.getNumFrets(),i=f.getTuning(),j=e.getScaleTones(e.getNoteValue(b),Vex.Flow.Music.arpeggios[c]),k=e.getNoteValue(b),l=[],m=0;m<f.getNumStrings();m++)for(var n=e.getNoteValue(i[m].toLowerCase()),o=n+(g-1),p=0;h>p;p++){var q=(o+p)%12;if(_.include(j,q)){var r={string:m,fret:g-1+p};if(r.fret<=0)continue;q==k&&(r.tonic=!0,r.color="black"),l.push(_.clone(r))}}return f.addNotes(l),f}},parseChordsInPage:function(a){a||(a="chord"),$("."+a).each(function(){var a=$(this).html(),b=$(this)[0];return $(this).html(""),$(this).append('<p class="chord-str" style="display: none;">'+a+"</p>"),$(this).css("display","inline-block"),ChordMaker.makeChordFromString(b,a,.5)})}}}();